var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
(function (factory) {
    if (typeof module === 'object' && typeof module.exports === 'object') {
        var v = factory(require, exports); if (v !== undefined) module.exports = v;
    }
    else if (typeof define === 'function' && define.amd) {
        define(["require", "exports", './decorators', './global'], factory);
    }
})(function (require, exports) {
    "use strict";
    var decorators_1 = require('./decorators');
    var global_1 = require('./global');
    var Shim;
    (function (Shim) {
        var DELETED = {};
        function getUID() {
            return Math.floor(Math.random() * 100000000);
        }
        var generateName = (function () {
            var startId = Math.floor(Date.now() % 100000000);
            return function generateName() {
                return '__wm' + getUID() + (startId++ + '__');
            };
        })();
        var WeakMap = (function () {
            function WeakMap(iterable) {
                Object.defineProperty(this, '_name', {
                    value: generateName()
                });
                if (iterable) {
                    for (var _i = 0, iterable_1 = iterable; _i < iterable_1.length; _i++) {
                        var _a = iterable_1[_i], key = _a[0], value = _a[1];
                        this.set(key, value);
                    }
                }
            }
            WeakMap.prototype.delete = function (key) {
                var entry = key[this._name];
                if (entry && entry.key === key && entry.value !== DELETED) {
                    entry.value = DELETED;
                    return true;
                }
                return false;
            };
            WeakMap.prototype.get = function (key) {
                var entry = key[this._name];
                if (entry && entry.key === key && entry.value !== DELETED) {
                    return entry.value;
                }
            };
            WeakMap.prototype.has = function (key) {
                var entry = key[this._name];
                return Boolean(entry && entry.key === key && entry.value !== DELETED);
            };
            WeakMap.prototype.set = function (key, value) {
                if (!key || (typeof key !== 'object' && typeof key !== 'function')) {
                    throw new TypeError('Invalid value used as weak map key');
                }
                var entry = key[this._name];
                if (!entry || entry.key !== key) {
                    entry = Object.create(null, {
                        key: { value: key }
                    });
                    Object.defineProperty(key, this._name, {
                        value: entry
                    });
                }
                entry.value = value;
                return this;
            };
            return WeakMap;
        }());
        Shim.WeakMap = WeakMap;
    })(Shim || (Shim = {}));
    var WeakMap = (function () {
        /* istanbul ignore next */
        function WeakMap(iterable) {
        }
        /* istanbul ignore next */
        WeakMap.prototype.delete = function (key) { throw new Error(); };
        /* istanbul ignore next */
        WeakMap.prototype.get = function (key) { throw new Error(); };
        /* istanbul ignore next */
        WeakMap.prototype.has = function (key) { throw new Error(); };
        /* istanbul ignore next */
        WeakMap.prototype.set = function (key, value) { throw new Error(); };
        WeakMap = __decorate([
            decorators_1.hasClass('weakmap', global_1.default.WeakMap, Shim.WeakMap)
        ], WeakMap);
        return WeakMap;
    }());
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.default = WeakMap;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2Vha01hcC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9XZWFrTWFwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztJQUFBLDJCQUF5QixjQUFjLENBQUMsQ0FBQTtJQUN4Qyx1QkFBbUIsVUFBVSxDQUFDLENBQUE7SUFFOUIsSUFBTyxJQUFJLENBd0VWO0lBeEVELFdBQU8sSUFBSSxFQUFDLENBQUM7UUFDWixJQUFNLE9BQU8sR0FBUSxFQUFFLENBQUM7UUFPeEI7WUFDQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsU0FBUyxDQUFDLENBQUM7UUFDOUMsQ0FBQztRQUVELElBQUksWUFBWSxHQUFHLENBQUM7WUFDbkIsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsU0FBUyxDQUFDLENBQUM7WUFFakQsTUFBTSxDQUFDO2dCQUNOLE1BQU0sQ0FBQyxNQUFNLEdBQUcsTUFBTSxFQUFFLEdBQUcsQ0FBQyxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztZQUMvQyxDQUFDLENBQUM7UUFDSCxDQUFDLENBQUMsRUFBRSxDQUFDO1FBRUw7WUFHQyxpQkFBWSxRQUFjO2dCQUN6QixNQUFNLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxPQUFPLEVBQUU7b0JBQ3BDLEtBQUssRUFBRSxZQUFZLEVBQUU7aUJBQ3JCLENBQUMsQ0FBQztnQkFDSCxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO29CQUNkLEdBQUcsQ0FBQyxDQUF5QixVQUFRLEVBQVIscUJBQVEsRUFBUixzQkFBUSxFQUFSLElBQVEsQ0FBQzt3QkFBakMsdUJBQW9CLEVBQVosV0FBRyxFQUFFLGFBQUs7d0JBQ3RCLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO3FCQUNyQjtnQkFDRixD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QUFNLElBQUksS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBWjdEO1lBQUMscUJBQVEsQ0FBQyxTQUFTLEVBQUUsZ0JBQU0sQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQzttQkFBQTtRQWFsRCxjQUFDO0lBQUQsQ0FBQyxBQVpELElBWUM7SUFaRDs2QkFZQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaGFzQ2xhc3MgfSBmcm9tICcuL2RlY29yYXRvcnMnO1xuaW1wb3J0IGdsb2JhbCBmcm9tICcuL2dsb2JhbCc7XG5cbm1vZHVsZSBTaGltIHtcblx0Y29uc3QgREVMRVRFRDogYW55ID0ge307XG5cblx0aW50ZXJmYWNlIEVudHJ5PEssIFY+IHtcblx0XHRrZXk6IEs7XG5cdFx0dmFsdWU6IFY7XG5cdH1cblxuXHRmdW5jdGlvbiBnZXRVSUQoKTogbnVtYmVyIHtcblx0XHRyZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDAwMDAwKTtcblx0fVxuXG5cdGxldCBnZW5lcmF0ZU5hbWUgPSAoZnVuY3Rpb24gKCkge1xuXHRcdGxldCBzdGFydElkID0gTWF0aC5mbG9vcihEYXRlLm5vdygpICUgMTAwMDAwMDAwKTtcblxuXHRcdHJldHVybiBmdW5jdGlvbiBnZW5lcmF0ZU5hbWUoKTogc3RyaW5nIHtcblx0XHRcdHJldHVybiAnX193bScgKyBnZXRVSUQoKSArIChzdGFydElkKysgKyAnX18nKTtcblx0XHR9O1xuXHR9KSgpO1xuXG5cdGV4cG9ydCBjbGFzcyBXZWFrTWFwPEssIFY+IHtcblx0XHRwcml2YXRlIF9uYW1lOiBzdHJpbmc7XG5cblx0XHRjb25zdHJ1Y3RvcihpdGVyYWJsZT86IGFueSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICdfbmFtZScsIHtcblx0XHRcdFx0dmFsdWU6IGdlbmVyYXRlTmFtZSgpXG5cdFx0XHR9KTtcblx0XHRcdGlmIChpdGVyYWJsZSkge1xuXHRcdFx0XHRmb3IgKGNvbnN0IFsga2V5LCB2YWx1ZSBdIG9mIGl0ZXJhYmxlKSB7XG5cdFx0XHRcdFx0dGhpcy5zZXQoa2V5LCB2YWx1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRkZWxldGUoa2V5OiBhbnkpOiBib29sZWFuIHtcblx0XHRcdGNvbnN0IGVudHJ5OiBFbnRyeTxLLCBWPiA9IGtleVt0aGlzLl9uYW1lXTtcblx0XHRcdGlmIChlbnRyeSAmJiBlbnRyeS5rZXkgPT09IGtleSAmJiBlbnRyeS52YWx1ZSAhPT0gREVMRVRFRCkge1xuXHRcdFx0XHRlbnRyeS52YWx1ZSA9IERFTEVURUQ7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdGdldChrZXk6IGFueSk6IFYge1xuXHRcdFx0Y29uc3QgZW50cnk6IEVudHJ5PEssIFY+ID0ga2V5W3RoaXMuX25hbWVdO1xuXHRcdFx0aWYgKGVudHJ5ICYmIGVudHJ5LmtleSA9PT0ga2V5ICYmIGVudHJ5LnZhbHVlICE9PSBERUxFVEVEKSB7XG5cdFx0XHRcdHJldHVybiBlbnRyeS52YWx1ZTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRoYXMoa2V5OiBhbnkpOiBib29sZWFuIHtcblx0XHRcdGNvbnN0IGVudHJ5OiBFbnRyeTxLLCBWPiA9IGtleVt0aGlzLl9uYW1lXTtcblx0XHRcdHJldHVybiBCb29sZWFuKGVudHJ5ICYmIGVudHJ5LmtleSA9PT0ga2V5ICYmIGVudHJ5LnZhbHVlICE9PSBERUxFVEVEKTtcblx0XHR9XG5cblx0XHRzZXQoa2V5OiBhbnksIHZhbHVlPzogYW55KTogU2hpbS5XZWFrTWFwPEssIFY+IHtcblx0XHRcdGlmICgha2V5IHx8ICh0eXBlb2Yga2V5ICE9PSAnb2JqZWN0JyAmJiB0eXBlb2Yga2V5ICE9PSAnZnVuY3Rpb24nKSkge1xuXHRcdFx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKCdJbnZhbGlkIHZhbHVlIHVzZWQgYXMgd2VhayBtYXAga2V5Jyk7XG5cdFx0XHR9XG5cdFx0XHRsZXQgZW50cnk6IEVudHJ5PEssIFY+ID0ga2V5W3RoaXMuX25hbWVdO1xuXHRcdFx0aWYgKCFlbnRyeSB8fCBlbnRyeS5rZXkgIT09IGtleSkge1xuXHRcdFx0XHRlbnRyeSA9IE9iamVjdC5jcmVhdGUobnVsbCwge1xuXHRcdFx0XHRcdGtleTogeyB2YWx1ZToga2V5IH1cblx0XHRcdFx0fSk7XG5cdFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShrZXksIHRoaXMuX25hbWUsIHtcblx0XHRcdFx0XHR2YWx1ZTogZW50cnlcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRlbnRyeS52YWx1ZSA9IHZhbHVlO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXHR9XG59XG5cbkBoYXNDbGFzcygnd2Vha21hcCcsIGdsb2JhbC5XZWFrTWFwLCBTaGltLldlYWtNYXApXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBXZWFrTWFwPEssIFY+IHtcblx0LyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cblx0Y29uc3RydWN0b3IoaXRlcmFibGU/OiBhbnkpIHt9XG5cblx0LyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cblx0ZGVsZXRlKGtleTogSyk6IGJvb2xlYW4geyB0aHJvdyBuZXcgRXJyb3IoKTsgfVxuXHQvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xuXHRnZXQoa2V5OiBLKTogViB7IHRocm93IG5ldyBFcnJvcigpOyB9XG5cdC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG5cdGhhcyhrZXk6IEspOiBib29sZWFuIHsgdGhyb3cgbmV3IEVycm9yKCk7IH1cblx0LyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cblx0c2V0KGtleTogSywgdmFsdWU/OiBWKTogV2Vha01hcDxLLCBWPiB7IHRocm93IG5ldyBFcnJvcigpOyB9XG59XG4iXX0=