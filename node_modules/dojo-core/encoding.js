(function (factory) {
    if (typeof module === 'object' && typeof module.exports === 'object') {
        var v = factory(require, exports); if (v !== undefined) module.exports = v;
    }
    else if (typeof define === 'function' && define.amd) {
        define(["require", "exports", './string'], factory);
    }
})(function (require, exports) {
    "use strict";
    var string_1 = require('./string');
    var BASE64_KEYSTR = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
    function decodeUtf8EncodedCodePoint(codePoint, validationRange, checkSurrogate) {
        if (validationRange === void 0) { validationRange = [0, Infinity]; }
        if (codePoint < validationRange[0] || codePoint > validationRange[1]) {
            throw Error('Invalid continuation byte');
        }
        if (checkSurrogate && codePoint >= string_1.HIGH_SURROGATE_MIN && codePoint <= string_1.LOW_SURROGATE_MAX) {
            throw Error('Surrogate is not a scalar value');
        }
        var encoded = '';
        if (codePoint > 0xFFFF) {
            codePoint -= 0x010000;
            encoded += String.fromCharCode(codePoint >>> 0x10 & 0x03FF | string_1.HIGH_SURROGATE_MIN);
            codePoint = string_1.LOW_SURROGATE_MIN | codePoint & 0x03FF;
        }
        encoded += String.fromCharCode(codePoint);
        return encoded;
    }
    function validateUtf8EncodedCodePoint(codePoint) {
        if ((codePoint & 0xC0) !== 0x80) {
            throw Error('Invalid continuation byte');
        }
    }
    /**
     * Provides facilities for encoding a string into an ASCII-encoded byte buffer and
     * decoding an ASCII-encoded byte buffer into a string.
     */
    exports.ascii = {
        /**
         * Encodes a string into an ASCII-encoded byte buffer.
         *
         * @param data The text string to encode
         */
        encode: function (data) {
            if (data == null) {
                return [];
            }
            var buffer = [];
            for (var i = 0, length_1 = data.length; i < length_1; i++) {
                buffer[i] = data.charCodeAt(i);
            }
            return buffer;
        },
        /**
         * Decodes an ASCII-encoded byte buffer into a string.
         *
         * @param data The byte buffer to decode
         */
        decode: function (data) {
            if (data == null) {
                return '';
            }
            var decoded = '';
            for (var i = 0, length_2 = data.length; i < length_2; i++) {
                decoded += String.fromCharCode(data[i]);
            }
            return decoded;
        }
    };
    /**
     * Provides facilities for encoding a string into a Base64-encoded byte buffer and
     * decoding a Base64-encoded byte buffer into a string.
     */
    exports.base64 = {
        /**
         * Encodes a Base64-encoded string into a Base64 byte buffer.
         *
         * @param data The Base64-encoded string to encode
         */
        encode: function (data) {
            if (data == null) {
                return [];
            }
            var buffer = [];
            var i = 0;
            var length = data.length;
            while (data[--length] === '=') { }
            while (i < length) {
                var encoded = BASE64_KEYSTR.indexOf(data[i++]) << 18;
                if (i <= length) {
                    encoded |= BASE64_KEYSTR.indexOf(data[i++]) << 12;
                }
                if (i <= length) {
                    encoded |= BASE64_KEYSTR.indexOf(data[i++]) << 6;
                }
                if (i <= length) {
                    encoded |= BASE64_KEYSTR.indexOf(data[i++]);
                }
                buffer.push((encoded >>> 16) & 0xff);
                buffer.push((encoded >>> 8) & 0xff);
                buffer.push(encoded & 0xff);
            }
            while (buffer[buffer.length - 1] === 0) {
                buffer.pop();
            }
            return buffer;
        },
        /**
         * Decodes a Base64-encoded byte buffer into a Base64-encoded string.
         *
         * @param data The byte buffer to decode
         */
        decode: function (data) {
            if (data == null) {
                return '';
            }
            var decoded = '';
            var i = 0;
            for (var length_3 = data.length - (data.length % 3); i < length_3;) {
                var encoded = data[i++] << 16 | data[i++] << 8 | data[i++];
                decoded += BASE64_KEYSTR.charAt((encoded >>> 18) & 0x3F);
                decoded += BASE64_KEYSTR.charAt((encoded >>> 12) & 0x3F);
                decoded += BASE64_KEYSTR.charAt((encoded >>> 6) & 0x3F);
                decoded += BASE64_KEYSTR.charAt(encoded & 0x3F);
            }
            if (data.length % 3 === 1) {
                var encoded = data[i++] << 16;
                decoded += BASE64_KEYSTR.charAt((encoded >>> 18) & 0x3f);
                decoded += BASE64_KEYSTR.charAt((encoded >>> 12) & 0x3f);
                decoded += '==';
            }
            else if (data.length % 3 === 2) {
                var encoded = data[i++] << 16 | data[i++] << 8;
                decoded += BASE64_KEYSTR.charAt((encoded >>> 18) & 0x3f);
                decoded += BASE64_KEYSTR.charAt((encoded >>> 12) & 0x3f);
                decoded += BASE64_KEYSTR.charAt((encoded >>> 6) & 0x3f);
                decoded += '=';
            }
            return decoded;
        }
    };
    /**
     * Provides facilities for encoding a string into a hex-encoded byte buffer and
     * decoding a hex-encoded byte buffer into a string.
     */
    exports.hex = {
        /**
         * Encodes a string into a hex-encoded byte buffer.
         *
         * @param data The hex-encoded string to encode
         */
        encode: function (data) {
            if (data == null) {
                return [];
            }
            var buffer = [];
            for (var i = 0, length_4 = data.length; i < length_4; i += 2) {
                var encodedChar = parseInt(data.substr(i, 2), 16);
                buffer.push(encodedChar);
            }
            return buffer;
        },
        /**
         * Decodes a hex-encoded byte buffer into a hex-encoded string.
         *
         * @param data The byte buffer to decode
         */
        decode: function (data) {
            if (data == null) {
                return '';
            }
            var decoded = '';
            for (var i = 0, length_5 = data.length; i < length_5; i++) {
                decoded += data[i].toString(16).toUpperCase();
            }
            return decoded;
        }
    };
    /**
     * Provides facilities for encoding a string into a UTF-8-encoded byte buffer and
     * decoding a UTF-8-encoded byte buffer into a string.
     * Inspired by the work of: https://github.com/mathiasbynens/utf8.js
     */
    exports.utf8 = {
        /**
         * Encodes a string into a UTF-8-encoded byte buffer.
         *
         * @param data The text string to encode
         */
        encode: function (data) {
            if (data == null) {
                return [];
            }
            var buffer = [];
            for (var i = 0, length_6 = data.length; i < length_6; i++) {
                var encodedChar = data.charCodeAt(i);
                /**
                 * Surrogates
                 * http://en.wikipedia.org/wiki/Universal_Character_Set_characters
                 */
                if (encodedChar >= string_1.HIGH_SURROGATE_MIN && encodedChar <= string_1.HIGH_SURROGATE_MAX) {
                    var lowSurrogate = data.charCodeAt(i + 1);
                    if (lowSurrogate >= string_1.LOW_SURROGATE_MIN && lowSurrogate <= string_1.LOW_SURROGATE_MAX) {
                        encodedChar = 0x010000 + (encodedChar - string_1.HIGH_SURROGATE_MIN) * 0x0400 + (lowSurrogate - string_1.LOW_SURROGATE_MIN);
                        i++;
                    }
                }
                if (encodedChar < 0x80) {
                    buffer.push(encodedChar);
                }
                else {
                    if (encodedChar < 0x800) {
                        buffer.push(((encodedChar >> 0x06) & 0x1F) | 0xC0);
                    }
                    else if (encodedChar < 0x010000) {
                        if (encodedChar >= string_1.HIGH_SURROGATE_MIN && encodedChar <= string_1.LOW_SURROGATE_MAX) {
                            throw Error('Surrogate is not a scalar value');
                        }
                        buffer.push(((encodedChar >> 0x0C) & 0x0F) | 0xE0);
                        buffer.push(((encodedChar >> 0x06) & 0x3F) | 0x80);
                    }
                    else if (encodedChar < 0x200000) {
                        buffer.push(((encodedChar >> 0x12) & 0x07) | 0xF0);
                        buffer.push(((encodedChar >> 0x0C) & 0x3F) | 0x80);
                        buffer.push(((encodedChar >> 0x06) & 0x3F) | 0x80);
                    }
                    buffer.push((encodedChar & 0x3F) | 0x80);
                }
            }
            return buffer;
        },
        /**
         * Decodes a UTF-8-encoded byte buffer into a string.
         *
         * @param data The byte buffer to decode
         */
        decode: function (data) {
            if (data == null) {
                return '';
            }
            var decoded = '';
            for (var i = 0, length_7 = data.length; i < length_7; i++) {
                var byte1 = data[i] & 0xFF;
                if ((byte1 & 0x80) === 0) {
                    decoded += decodeUtf8EncodedCodePoint(byte1);
                }
                else if ((byte1 & 0xE0) === 0xC0) {
                    var byte2 = data[++i] & 0xFF;
                    validateUtf8EncodedCodePoint(byte2);
                    byte2 = byte2 & 0x3F;
                    var encodedByte = ((byte1 & 0x1F) << 0x06) | byte2;
                    decoded += decodeUtf8EncodedCodePoint(encodedByte, [0x80, Infinity]);
                }
                else if ((byte1 & 0xF0) === 0xE0) {
                    var byte2 = data[++i] & 0xFF;
                    validateUtf8EncodedCodePoint(byte2);
                    byte2 = byte2 & 0x3F;
                    var byte3 = data[++i] & 0xFF;
                    validateUtf8EncodedCodePoint(byte3);
                    byte3 = byte3 & 0x3F;
                    var encodedByte = ((byte1 & 0x1F) << 0x0C) | (byte2 << 0x06) | byte3;
                    decoded += decodeUtf8EncodedCodePoint(encodedByte, [0x0800, Infinity], true);
                }
                else if ((byte1 & 0xF8) === 0xF0) {
                    var byte2 = data[++i] & 0xFF;
                    validateUtf8EncodedCodePoint(byte2);
                    byte2 = byte2 & 0x3F;
                    var byte3 = data[++i] & 0xFF;
                    validateUtf8EncodedCodePoint(byte3);
                    byte3 = byte3 & 0x3F;
                    var byte4 = data[++i] & 0xFF;
                    validateUtf8EncodedCodePoint(byte4);
                    byte4 = byte4 & 0x3F;
                    var encodedByte = ((byte1 & 0x1F) << 0x0C) | (byte2 << 0x0C) | (byte3 << 0x06) | byte4;
                    decoded += decodeUtf8EncodedCodePoint(encodedByte, [0x010000, 0x10FFFF]);
                }
                else {
                    validateUtf8EncodedCodePoint(byte1);
                }
            }
            return decoded;
        }
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW5jb2RpbmcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZW5jb2RpbmcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0lBQUEsdUJBQTZGLFVBQVUsQ0FBQyxDQUFBO0lBRXhHLElBQU0sYUFBYSxHQUFHLG1FQUFtRSxDQUFDO0lBRTFGLG9DQUFvQyxTQUFpQixFQUFFLGVBQTJDLEVBQUUsY0FBd0I7UUFBckUsK0JBQTJDLEdBQTNDLG1CQUE4QixDQUFDLEVBQUUsUUFBUSxDQUFFO1FBQ2pHLEVBQUUsQ0FBQyxDQUFDLFNBQVMsR0FBRyxlQUFlLENBQUMsQ0FBQyxDQUFDLElBQUksU0FBUyxHQUFHLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEUsTUFBTSxLQUFLLENBQUMsMkJBQTJCLENBQUMsQ0FBQztRQUMxQyxDQUFDO1FBRUQsRUFBRSxDQUFDLENBQUMsY0FBYyxJQUFJLFNBQVMsSUFBSSwyQkFBa0IsSUFBSSxTQUFTLElBQUksMEJBQWlCLENBQUMsQ0FBQyxDQUFDO1lBQ3pGLE1BQU0sS0FBSyxDQUFDLGlDQUFpQyxDQUFDLENBQUM7UUFDaEQsQ0FBQztRQUVELElBQUksT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUVqQixFQUFFLENBQUMsQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUN4QixTQUFTLElBQUksUUFBUSxDQUFDO1lBQ3RCLE9BQU8sSUFBSSxNQUFNLENBQUMsWUFBWSxDQUFDLFNBQVMsS0FBSyxJQUFJLEdBQUcsTUFBTSxHQUFHLDJCQUFrQixDQUFDLENBQUM7WUFDakYsU0FBUyxHQUFHLDBCQUFpQixHQUFHLFNBQVMsR0FBRyxNQUFNLENBQUM7UUFDcEQsQ0FBQztRQUVELE9BQU8sSUFBSSxNQUFNLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRTFDLE1BQU0sQ0FBQyxPQUFPLENBQUM7SUFDaEIsQ0FBQztJQUVELHNDQUFzQyxTQUFpQjtR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SUFBSSxDQUFDO29CQUVyQixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUM7b0JBQzdCLDRCQUE0QixDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUNwQyxLQUFLLEdBQUcsS0FBSyxHQUFHLElBQUksQ0FBQztvQkFFckIsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDO29CQUM3Qiw0QkFBNEIsQ0FBQyxLQUFLLENBQUMsQ0FBQztvQkFDcEMsS0FBSyxHQUFHLEtBQUssR0FBRyxJQUFJLENBQUM7b0JBRXJCLElBQUksV0FBVyxHQUFHLENBQUMsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEdBQUcsS0FBSyxDQUFDO29CQUN2RixPQUFPLElBQUksMEJBQTBCLENBQUMsV0FBVyxFQUFFLENBQUUsUUFBUSxFQUFFLFFBQVEsQ0FBRSxDQUFDLENBQUM7Z0JBQzVFLENBQUM7Z0JBQ0QsSUFBSSxDQUFDLENBQUM7b0JBQ0wsNEJBQTRCLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3JDLENBQUM7WUFDRixDQUFDO1lBRUQsTUFBTSxDQUFDLE9BQU8sQ0FBQztRQUNoQixDQUFDO0tBQ0QsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEhJR0hfU1VSUk9HQVRFX01JTiwgSElHSF9TVVJST0dBVEVfTUFYLCBMT1dfU1VSUk9HQVRFX01JTiwgTE9XX1NVUlJPR0FURV9NQVggfSBmcm9tICcuL3N0cmluZyc7XG5cbmNvbnN0IEJBU0U2NF9LRVlTVFIgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0nO1xuXG5mdW5jdGlvbiBkZWNvZGVVdGY4RW5jb2RlZENvZGVQb2ludChjb2RlUG9pbnQ6IG51bWJlciwgdmFsaWRhdGlvblJhbmdlOiBudW1iZXJbXSA9IFsgMCwgSW5maW5pdHkgXSwgY2hlY2tTdXJyb2dhdGU/OiBib29sZWFuKTogc3RyaW5nIHtcblx0aWYgKGNvZGVQb2ludCA8IHZhbGlkYXRpb25SYW5nZVswXSB8fCBjb2RlUG9pbnQgPiB2YWxpZGF0aW9uUmFuZ2VbMV0pIHtcblx0XHR0aHJvdyBFcnJvcignSW52YWxpZCBjb250aW51YXRpb24gYnl0ZScpO1xuXHR9XG5cblx0aWYgKGNoZWNrU3Vycm9nYXRlICYmIGNvZGVQb2ludCA+PSBISUdIX1NVUlJPR0FURV9NSU4gJiYgY29kZVBvaW50IDw9IExPV19TVVJST0dBVEVfTUFYKSB7XG5cdFx0dGhyb3cgRXJyb3IoJ1N1cnJvZ2F0ZSBpcyBub3QgYSBzY2FsYXIgdmFsdWUnKTtcblx0fVxuXG5cdGxldCBlbmNvZGVkID0gJyc7XG5cblx0aWYgKGNvZGVQb2ludCA+IDB4RkZGRikge1xuXHRcdGNvZGVQb2ludCAtPSAweDAxMDAwMDtcblx0XHRlbmNvZGVkICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZVBvaW50ID4+PiAweDEwICYgMHgwM0ZGIHwgSElHSF9TVVJST0dBVEVfTUlOKTtcblx0XHRjb2RlUG9pbnQgPSBMT1dfU1VSUk9HQVRFX01JTiB8IGNvZGVQb2ludCAmIDB4MDNGRjtcblx0fVxuXG5cdGVuY29kZWQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlUG9pbnQpO1xuXG5cdHJldHVybiBlbmNvZGVkO1xufVxuXG5mdW5jdGlvbiB2YWxpZGF0ZVV0ZjhFbmNvZGVkQ29kZVBvaW50KGNvZGVQb2ludDogbnVtYmVyKTogdm9pZCB7XG5cdGlmICgoY29kZVBvaW50ICYgMHhDMCkgIT09IDB4ODApIHtcblx0XHR0aHJvdyBFcnJvcignSW52YWxpZCBjb250aW51YXRpb24gYnl0ZScpO1xuXHR9XG59XG5cbmV4cG9ydCB0eXBlIEJ5dGVCdWZmZXIgPSBVaW50OEFycmF5IHwgQnVmZmVyIHwgbnVtYmVyW107XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29kZWMge1xuXHRlbmNvZGUoZGF0YTogc3RyaW5nKTogbnVtYmVyW107XG5cdGRlY29kZShkYXRhOiBCeXRlQnVmZmVyKTogc3RyaW5nO1xufVxuXG4vKipcbiAqIFByb3ZpZGVzIGZhY2lsaXRpZXMgZm9yIGVuY29kaW5nIGEgc3RyaW5nIGludG8gYW4gQVNDSUktZW5jb2RlZCBieXRlIGJ1ZmZlciBhbmRcbiAqIGRlY29kaW5nIGFuIEFTQ0lJLWVuY29kZWQgYnl0ZSBidWZmZXIgaW50byBhIHN0cmluZy5cbiAqL1xuZXhwb3J0IGNvbnN0IGFzY2lpOiBDb2RlYyA9IHtcblx0LyoqXG5cdCAqIEVuY29kZXMgYSBzdHJpbmcgaW50byBhbiBBU0NJSS1lbmNvZGVkIGJ5dGUgYnVmZmVyLlxuXHQgKlxuXHQgKiBAcGFyYW0gZGF0YSBUaGUgdGV4dCBzdHJpbmcgdG8gZW5jb2RlXG5cdCAqL1xuXHRlbmNvZGUoZGF0YTogc3RyaW5nKTogbnVtYmVyW10ge1xuXHRcdGlmIChkYXRhID09IG51bGwpIHtcblx0XHRcdHJldHVybiBbXTtcblx0XHR9XG5cblx0XHRjb25zdCBidWZmZXI6IG51bWJlcltdID0gW107XG5cblx0XHRmb3IgKGxldCBpID0gMCwgbGVuZ3RoID0gZGF0YS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuXHRcdFx0YnVmZmVyW2ldID0gZGF0YS5jaGFyQ29kZUF0KGkpO1xuXHRcdH1cblxuXHRcdHJldHVybiBidWZmZXI7XG5cdH0sXG5cblx0LyoqXG5cdCAqIERlY29kZXMgYW4gQVNDSUktZW5jb2RlZCBieXRlIGJ1ZmZlciBpbnRvIGEgc3RyaW5nLlxuXHQgKlxuXHQgKiBAcGFyYW0gZGF0YSBUaGUgYnl0ZSBidWZmZXIgdG8gZGVjb2RlXG5cdCAqL1xuXHRkZWNvZGUoZGF0YTogQnl0ZUJ1ZmZlcik6IHN0cmluZyB7XG5cdFx0aWYgKGRhdGEgPT0gbnVsbCkge1xuXHRcdFx0cmV0dXJuICcnO1xuXHRcdH1cblxuXHRcdGxldCBkZWNvZGVkID0gJyc7XG5cblx0XHRmb3IgKGxldCBpID0gMCwgbGVuZ3RoID0gZGF0YS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuXHRcdFx0ZGVjb2RlZCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGRhdGFbaV0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBkZWNvZGVkO1xuXHR9XG59O1xuXG4vKipcbiAqIFByb3ZpZGVzIGZhY2lsaXRpZXMgZm9yIGVuY29kaW5nIGEgc3RyaW5nIGludG8gYSBCYXNlNjQtZW5jb2RlZCBieXRlIGJ1ZmZlciBhbmRcbiAqIGRlY29kaW5nIGEgQmFzZTY0LWVuY29kZWQgYnl0ZSBidWZmZXIgaW50byBhIHN0cmluZy5cbiAqL1xuZXhwb3J0IGNvbnN0IGJhc2U2NDogQ29kZWMgPSB7XG5cdC8qKlxuXHQgKiBFbmNvZGVzIGEgQmFzZTY0LWVuY29kZWQgc3RyaW5nIGludG8gYSBCYXNlNjQgYnl0ZSBidWZmZXIuXG5cdCAqXG5cdCAqIEBwYXJhbSBkYXRhIFRoZSBCYXNlNjQtZW5jb2RlZCBzdHJpbmcgdG8gZW5jb2RlXG5cdCAqL1xuXHRlbmNvZGUoZGF0YTogc3RyaW5nKTogbnVtYmVyW10ge1xuXHRcdGlmIChkYXRhID09IG51bGwpIHtcblx0XHRcdHJldHVybiBbXTtcblx0XHR9XG5cblx0XHRjb25zdCBidWZmZXI6IG51bWJlcltdID0gW107XG5cblx0XHRsZXQgaSA9IDA7XG5cdFx0bGV0IGxlbmd0aCA9IGRhdGEubGVuZ3RoO1xuXG5cdFx0d2hpbGUgKGRhdGFbLS1sZW5ndGhdID09PSAnPScpIHsgfVxuXHRcdHdoaWxlIChpIDwgbGVuZ3RoKSB7XG5cdFx0XHRsZXQgZW5jb2RlZCA9IEJBU0U2NF9LRVlTVFIuaW5kZXhPZihkYXRhW2krK10pIDw8IDE4O1xuXHRcdFx0aWYgKGkgPD0gbGVuZ3RoKSB7XG5cdFx0XHRcdGVuY29kZWQgfD0gQkFTRTY0X0tFWVNUUi5pbmRleE9mKGRhdGFbaSsrXSkgPDwgMTI7XG5cdFx0XHR9XG5cdFx0XHRpZiAoaSA8PSBsZW5ndGgpIHtcblx0XHRcdFx0ZW5jb2RlZCB8PSBCQVNFNjRfS0VZU1RSLmluZGV4T2YoZGF0YVtpKytdKSA8PCA2O1xuXHRcdFx0fVxuXHRcdFx0aWYgKGkgPD0gbGVuZ3RoKSB7XG5cdFx0XHRcdGVuY29kZWQgfD0gQkFTRTY0X0tFWVNUUi5pbmRleE9mKGRhdGFbaSsrXSk7XG5cdFx0XHR9XG5cblx0XHRcdGJ1ZmZlci5wdXNoKChlbmNvZGVkID4+PiAxNikgJiAweGZmKTtcblx0XHRcdGJ1ZmZlci5wdXNoKChlbmNvZGVkID4+PiA4KSAmIDB4ZmYpO1xuXHRcdFx0YnVmZmVyLnB1c2goZW5jb2RlZCAmIDB4ZmYpO1xuXHRcdH1cblxuXHRcdHdoaWxlIChidWZmZXJbYnVmZmVyLmxlbmd0aCAtIDFdID09PSAwKSB7XG5cdFx0XHRidWZmZXIucG9wKCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGJ1ZmZlcjtcblx0fSxcblxuXHQvKipcblx0ICogRGVjb2RlcyBhIEJhc2U2NC1lbmNvZGVkIGJ5dGUgYnVmZmVyIGludG8gYSBCYXNlNjQtZW5jb2RlZCBzdHJpbmcuXG5cdCAqXG5cdCAqIEBwYXJhbSBkYXRhIFRoZSBieXRlIGJ1ZmZlciB0byBkZWNvZGVcblx0ICovXG5cdGRlY29kZShkYXRhOiBCeXRlQnVmZmVyKTogc3RyaW5nIHtcblx0XHRpZiAoZGF0YSA9PSBudWxsKSB7XG5cdFx0XHRyZXR1cm4gJyc7XG5cdFx0fVxuXG5cdFx0bGV0IGRlY29kZWQgPSAnJztcblx0XHRsZXQgaSA9IDA7XG5cblx0XHRmb3IgKGxldCBsZW5ndGggPSBkYXRhLmxlbmd0aCAtIChkYXRhLmxlbmd0aCAlIDMpOyBpIDwgbGVuZ3RoOyApIHtcblx0XHRcdGxldCBlbmNvZGVkID0gZGF0YVtpKytdIDw8IDE2IHwgZGF0YVtpKytdIDw8IDggfCBkYXRhW2krK107XG5cblx0XHRcdGRlY29kZWQgKz0gQkFTRTY0X0tFWVNUUi5jaGFyQXQoKGVuY29kZWQgPj4+IDE4KSAmIDB4M0YpO1xuXHRcdFx0ZGVjb2RlZCArPSBCQVNFNjRfS0VZU1RSLmNoYXJBdCgoZW5jb2RlZCA+Pj4gMTIpICYgMHgzRik7XG5cdFx0XHRkZWNvZGVkICs9IEJBU0U2NF9LRVlTVFIuY2hhckF0KChlbmNvZGVkID4+PiA2KSAmIDB4M0YpO1xuXHRcdFx0ZGVjb2RlZCArPSBCQVNFNjRfS0VZU1RSLmNoYXJBdChlbmNvZGVkICYgMHgzRik7XG5cdFx0fVxuXG5cdFx0aWYgKGRhdGEubGVuZ3RoICUgMyA9PT0gMSkge1xuXHRcdFx0bGV0IGVuY29kZWQgPSBkYXRhW2krK10gPDwgMTY7XG5cdFx0XHRkZWNvZGVkICs9IEJBU0U2NF9LRVlTVFIuY2hhckF0KChlbmNvZGVkID4+PiAxOCkgJiAweDNmKTtcblx0XHRcdGRlY29kZWQgKz0gQkFTRTY0X0tFWVNUUi5jaGFyQXQoKGVuY29kZWQgPj4+IDEyKSAmIDB4M2YpO1xuXHRcdFx0ZGVjb2RlZCArPSAnPT0nO1xuXHRcdH1cblx0XHRlbHNlIGlmIChkYXRhLmxlbmd0aCAlIDMgPT09IDIpIHtcblx0XHRcdGxldCBlbmNvZGVkID0gZGF0YVtpKytdIDw8IDE2IHwgZGF0YVtpKytdIDw8IDg7XG5cdFx0XHRkZWNvZGVkICs9IEJBU0U2NF9LRVlTVFIuY2hhckF0KChlbmNvZGVkID4+PiAxOCkgJiAweDNmKTtcblx0XHRcdGRlY29kZWQgKz0gQkFTRTY0X0tFWVNUUi5jaGFyQXQoKGVuY29kZWQgPj4+IDEyKSAmIDB4M2YpO1xuXHRcdFx0ZGVjb2RlZCArPSBCQVNFNjRfS0VZU1RSLmNoYXJBdCgoZW5jb2RlZCA+Pj4gNikgJiAweDNmKTtcblx0XHRcdGRlY29kZWQgKz0gJz0nO1xuXHRcdH1cblxuXHRcdHJldHVybiBkZWNvZGVkO1xuXHR9XG59O1xuXG4vKipcbiAqIFByb3ZpZGVzIGZhY2lsaXRpZXMgZm9yIGVuY29kaW5nIGEgc3RyaW5nIGludG8gYSBoZXgtZW5jb2RlZCBieXRlIGJ1ZmZlciBhbmRcbiAqIGRlY29kaW5nIGEgaGV4LWVuY29kZWQgYnl0ZSBidWZmZXIgaW50byBhIHN0cmluZy5cbiAqL1xuZXhwb3J0IGNvbnN0IGhleDogQ29kZWMgPSB7XG5cdC8qKlxuXHQgKiBFbmNvZGVzIGEgc3RyaW5nIGludG8gYSBoZXgtZW5jb2RlZCBieXRlIGJ1ZmZlci5cblx0ICpcblx0ICogQHBhcmFtIGRhdGEgVGhlIGhleC1lbmNvZGVkIHN0cmluZyB0byBlbmNvZGVcblx0ICovXG5cdGVuY29kZShkYXRhOiBzdHJpbmcpOiBudW1iZXJbXSB7XG5cdFx0aWYgKGRhdGEgPT0gbnVsbCkge1xuXHRcdFx0cmV0dXJuIFtdO1xuXHRcdH1cblxuXHRcdGNvbnN0IGJ1ZmZlcjogbnVtYmVyW10gPSBbXTtcblxuXHRcdGZvciAobGV0IGkgPSAwLCBsZW5ndGggPSBkYXRhLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSArPSAyKSB7XG5cdFx0XHRsZXQgZW5jb2RlZENoYXIgPSBwYXJzZUludChkYXRhLnN1YnN0cihpLCAyKSwgMTYpO1xuXG5cdFx0XHRidWZmZXIucHVzaChlbmNvZGVkQ2hhcik7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGJ1ZmZlcjtcblx0fSxcblxuXHQvKipcblx0ICogRGVjb2RlcyBhIGhleC1lbmNvZGVkIGJ5dGUgYnVmZmVyIGludG8gYSBoZXgtZW5jb2RlZCBzdHJpbmcuXG5cdCAqXG5cdCAqIEBwYXJhbSBkYXRhIFRoZSBieXRlIGJ1ZmZlciB0byBkZWNvZGVcblx0ICovXG5cdGRlY29kZShkYXRhOiBCeXRlQnVmZmVyKTogc3RyaW5nIHtcblx0XHRpZiAoZGF0YSA9PSBudWxsKSB7XG5cdFx0XHRyZXR1cm4gJyc7XG5cdFx0fVxuXG5cdFx0bGV0IGRlY29kZWQgPSAnJztcblxuXHRcdGZvciAobGV0IGkgPSAwLCBsZW5ndGggPSBkYXRhLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG5cdFx0XHRkZWNvZGVkICs9IGRhdGFbaV0udG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGRlY29kZWQ7XG5cdH1cbn07XG5cbi8qKlxuICogUHJvdmlkZXMgZmFjaWxpdGllcyBmb3IgZW5jb2RpbmcgYSBzdHJpbmcgaW50byBhIFVURi04LWVuY29kZWQgYnl0ZSBidWZmZXIgYW5kXG4gKiBkZWNvZGluZyBhIFVURi04LWVuY29kZWQgYnl0ZSBidWZmZXIgaW50byBhIHN0cmluZy5cbiAqIEluc3BpcmVkIGJ5IHRoZSB3b3JrIG9mOiBodHRwczovL2dpdGh1Yi5jb20vbWF0aGlhc2J5bmVucy91dGY4LmpzXG4gKi9cbmV4cG9ydCBjb25zdCB1dGY4OiBDb2RlYyA9IHtcblx0LyoqXG5cdCAqIEVuY29kZXMgYSBzdHJpbmcgaW50byBhIFVURi04LWVuY29kZWQgYnl0ZSBidWZmZXIuXG5cdCAqXG5cdCAqIEBwYXJhbSBkYXRhIFRoZSB0ZXh0IHN0cmluZyB0byBlbmNvZGVcblx0ICovXG5cdGVuY29kZShkYXRhOiBzdHJpbmcpOiBudW1iZXJbXSB7XG5cdFx0aWYgKGRhdGEgPT0gbnVsbCkge1xuXHRcdFx0cmV0dXJuIFtdO1xuXHRcdH1cblxuXHRcdGNvbnN0IGJ1ZmZlcjogbnVtYmVyW10gPSBbXTtcblxuXHRcdGZvciAobGV0IGkgPSAwLCBsZW5ndGggPSBkYXRhLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG5cdFx0XHRsZXQgZW5jb2RlZENoYXIgPSBkYXRhLmNoYXJDb2RlQXQoaSk7XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogU3Vycm9nYXRlc1xuXHRcdFx0ICogaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Vbml2ZXJzYWxfQ2hhcmFjdGVyX1NldF9jaGFyYWN0ZXJzXG5cdFx0XHQgKi9cblx0XHRcdGlmIChlbmNvZGVkQ2hhciA+PSBISUdIX1NVUlJPR0FURV9NSU4gJiYgZW5jb2RlZENoYXIgPD0gSElHSF9TVVJST0dBVEVfTUFYKSB7XG5cdFx0XHRcdGxldCBsb3dTdXJyb2dhdGUgPSBkYXRhLmNoYXJDb2RlQXQoaSArIDEpO1xuXHRcdFx0XHRpZiAobG93U3Vycm9nYXRlID49IExPV19TVVJST0dBVEVfTUlOICYmIGxvd1N1cnJvZ2F0ZSA8PSBMT1dfU1VSUk9HQVRFX01BWCkge1xuXHRcdFx0XHRcdGVuY29kZWRDaGFyID0gMHgwMTAwMDAgKyAoZW5jb2RlZENoYXIgLSBISUdIX1NVUlJPR0FURV9NSU4pICogMHgwNDAwICsgKGxvd1N1cnJvZ2F0ZSAtIExPV19TVVJST0dBVEVfTUlOKTtcblx0XHRcdFx0XHRpKys7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKGVuY29kZWRDaGFyIDwgMHg4MCkge1xuXHRcdFx0XHRidWZmZXIucHVzaChlbmNvZGVkQ2hhcik7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0aWYgKGVuY29kZWRDaGFyIDwgMHg4MDApIHtcblx0XHRcdFx0XHRidWZmZXIucHVzaCgoKGVuY29kZWRDaGFyID4+IDB4MDYpICYgMHgxRikgfCAweEMwKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRlbHNlIGlmIChlbmNvZGVkQ2hhciA8IDB4MDEwMDAwKSB7XG5cdFx0XHRcdFx0aWYgKGVuY29kZWRDaGFyID49IEhJR0hfU1VSUk9HQVRFX01JTiAmJiBlbmNvZGVkQ2hhciA8PSBMT1dfU1VSUk9HQVRFX01BWCkge1xuXHRcdFx0XHRcdFx0dGhyb3cgRXJyb3IoJ1N1cnJvZ2F0ZSBpcyBub3QgYSBzY2FsYXIgdmFsdWUnKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRidWZmZXIucHVzaCgoKGVuY29kZWRDaGFyID4+IDB4MEMpICYgMHgwRikgfCAweEUwKTtcblx0XHRcdFx0XHRidWZmZXIucHVzaCgoKGVuY29kZWRDaGFyID4+IDB4MDYpICYgMHgzRikgfCAweDgwKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRlbHNlIGlmIChlbmNvZGVkQ2hhciA8IDB4MjAwMDAwKSB7XG5cdFx0XHRcdFx0YnVmZmVyLnB1c2goKChlbmNvZGVkQ2hhciA+PiAweDEyKSAmIDB4MDcpIHwgMHhGMCk7XG5cdFx0XHRcdFx0YnVmZmVyLnB1c2goKChlbmNvZGVkQ2hhciA+PiAweDBDKSAmIDB4M0YpIHwgMHg4MCk7XG5cdFx0XHRcdFx0YnVmZmVyLnB1c2goKChlbmNvZGVkQ2hhciA+PiAweDA2KSAmIDB4M0YpIHwgMHg4MCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0YnVmZmVyLnB1c2goKGVuY29kZWRDaGFyICYgMHgzRikgfCAweDgwKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gYnVmZmVyO1xuXHR9LFxuXG5cdC8qKlxuXHQgKiBEZWNvZGVzIGEgVVRGLTgtZW5jb2RlZCBieXRlIGJ1ZmZlciBpbnRvIGEgc3RyaW5nLlxuXHQgKlxuXHQgKiBAcGFyYW0gZGF0YSBUaGUgYnl0ZSBidWZmZXIgdG8gZGVjb2RlXG5cdCAqL1xuXHRkZWNvZGUoZGF0YTogQnl0ZUJ1ZmZlcik6IHN0cmluZyB7XG5cdFx0aWYgKGRhdGEgPT0gbnVsbCkge1xuXHRcdFx0cmV0dXJuICcnO1xuXHRcdH1cblxuXHRcdGxldCBkZWNvZGVkID0gJyc7XG5cblx0XHRmb3IgKGxldCBpID0gMCwgbGVuZ3RoID0gZGF0YS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuXHRcdFx0bGV0IGJ5dGUxID0gZGF0YVtpXSAmIDB4RkY7XG5cblx0XHRcdGlmICgoYnl0ZTEgJiAweDgwKSA9PT0gMCkge1xuXHRcdFx0XHRkZWNvZGVkICs9IGRlY29kZVV0ZjhFbmNvZGVkQ29kZVBvaW50KGJ5dGUxKTtcblx0XHRcdH1cblx0XHRcdGVsc2UgaWYgKChieXRlMSAmIDB4RTApID09PSAweEMwKSB7XG5cdFx0XHRcdGxldCBieXRlMiA9IGRhdGFbKytpXSAmIDB4RkY7XG5cdFx0XHRcdHZhbGlkYXRlVXRmOEVuY29kZWRDb2RlUG9pbnQoYnl0ZTIpO1xuXHRcdFx0XHRieXRlMiA9IGJ5dGUyICYgMHgzRjtcblx0XHRcdFx0bGV0IGVuY29kZWRCeXRlID0gKChieXRlMSAmIDB4MUYpIDw8IDB4MDYpIHwgYnl0ZTI7XG5cdFx0XHRcdGRlY29kZWQgKz0gZGVjb2RlVXRmOEVuY29kZWRDb2RlUG9pbnQoZW5jb2RlZEJ5dGUsIFsweDgwLCBJbmZpbml0eV0pO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSBpZiAoKGJ5dGUxICYgMHhGMCkgPT09IDB4RTApIHtcblx0XHRcdFx0bGV0IGJ5dGUyID0gZGF0YVsrK2ldICYgMHhGRjtcblx0XHRcdFx0dmFsaWRhdGVVdGY4RW5jb2RlZENvZGVQb2ludChieXRlMik7XG5cdFx0XHRcdGJ5dGUyID0gYnl0ZTIgJiAweDNGO1xuXG5cdFx0XHRcdGxldCBieXRlMyA9IGRhdGFbKytpXSAmIDB4RkY7XG5cdFx0XHRcdHZhbGlkYXRlVXRmOEVuY29kZWRDb2RlUG9pbnQoYnl0ZTMpO1xuXHRcdFx0XHRieXRlMyA9IGJ5dGUzICYgMHgzRjtcblxuXHRcdFx0XHRsZXQgZW5jb2RlZEJ5dGUgPSAoKGJ5dGUxICYgMHgxRikgPDwgMHgwQykgfCAoYnl0ZTIgPDwgMHgwNikgfCBieXRlMztcblx0XHRcdFx0ZGVjb2RlZCArPSBkZWNvZGVVdGY4RW5jb2RlZENvZGVQb2ludChlbmNvZGVkQnl0ZSwgWyAweDA4MDAsIEluZmluaXR5IF0sIHRydWUpO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSBpZiAoKGJ5dGUxICYgMHhGOCkgPT09IDB4RjApIHtcblx0XHRcdFx0bGV0IGJ5dGUyID0gZGF0YVsrK2ldICYgMHhGRjtcblx0XHRcdFx0dmFsaWRhdGVVdGY4RW5jb2RlZENvZGVQb2ludChieXRlMik7XG5cdFx0XHRcdGJ5dGUyID0gYnl0ZTIgJiAweDNGO1xuXG5cdFx0XHRcdGxldCBieXRlMyA9IGRhdGFbKytpXSAmIDB4RkY7XG5cdFx0XHRcdHZhbGlkYXRlVXRmOEVuY29kZWRDb2RlUG9pbnQoYnl0ZTMpO1xuXHRcdFx0XHRieXRlMyA9IGJ5dGUzICYgMHgzRjtcblxuXHRcdFx0XHRsZXQgYnl0ZTQgPSBkYXRhWysraV0gJiAweEZGO1xuXHRcdFx0XHR2YWxpZGF0ZVV0ZjhFbmNvZGVkQ29kZVBvaW50KGJ5dGU0KTtcblx0XHRcdFx0Ynl0ZTQgPSBieXRlNCAmIDB4M0Y7XG5cblx0XHRcdFx0bGV0IGVuY29kZWRCeXRlID0gKChieXRlMSAmIDB4MUYpIDw8IDB4MEMpIHwgKGJ5dGUyIDw8IDB4MEMpIHwgKGJ5dGUzIDw8IDB4MDYpIHwgYnl0ZTQ7XG5cdFx0XHRcdGRlY29kZWQgKz0gZGVjb2RlVXRmOEVuY29kZWRDb2RlUG9pbnQoZW5jb2RlZEJ5dGUsIFsgMHgwMTAwMDAsIDB4MTBGRkZGIF0pO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdHZhbGlkYXRlVXRmOEVuY29kZWRDb2RlUG9pbnQoYnl0ZTEpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBkZWNvZGVkO1xuXHR9XG59O1xuIl19